---
import SkipToContent from "../ui/SkipToContent.astro";
import { Image } from "astro:assets";
import Logo from "@/assets/logos/logo.svg";
import Search from "../ui/Search";
---

<SkipToContent />

<nav
  class="fixed top-0 left-0 right-0 z-50 liquid-glass-nav transition-all duration-300"
  id="main-nav"
  role="navigation"
  aria-label="Main navigation"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 hover:opacity-70 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 rounded-lg" aria-label="Home - Farhan Portfolio">
        <Image src={Logo} alt="Farhan Logo" class="w-8 h-8" />
        <span class="font-bold text-lg text-textPrimary hidden sm:inline">Farhan</span>
      </a>

      <!-- Desktop Navigation - Clean Apple Style -->
      <div class="hidden md:flex items-center gap-8" role="menubar">
        <a
          href="/#about"
          class="text-sm text-textSecondary hover:text-accent-blue transition-all duration-300 font-medium focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 rounded-lg px-3 py-2"
          role="menuitem"
          aria-label="Navigate to About section"
        >
          About
        </a>
        <a
          href="/#experience"
          class="text-sm text-textSecondary hover:text-accent-blue transition-all duration-300 font-medium focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 rounded-lg px-3 py-2"
          role="menuitem"
          aria-label="Navigate to Experience section"
        >
          Experience
        </a>
        <a
          href="/#projects"
          class="text-sm text-textSecondary hover:text-accent-blue transition-all duration-300 font-medium focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 rounded-lg px-3 py-2"
          role="menuitem"
          aria-label="Navigate to Projects section"
        >
          Projects
        </a>
        <a
          href="/#skills"
          class="text-sm text-textSecondary hover:text-accent-blue transition-all duration-300 font-medium focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 rounded-lg px-3 py-2"
          role="menuitem"
          aria-label="Navigate to Skills section"
        >
          Skills
        </a>
        <a
          href="/#contact"
          class="text-sm text-textSecondary hover:text-accent-blue transition-all duration-300 font-medium focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 rounded-lg px-3 py-2"
          role="menuitem"
          aria-label="Navigate to Contact section"
        >
          Contact
        </a>
      </div>

      <!-- Actions -->
      <div class="flex items-center gap-4">
        <!-- Search Component -->
        <Search client:only="react" />
        
        <a
          href="/#contact"
          class="hidden sm:inline-flex items-center justify-center liquid-glass-button text-accent-blue hover:bg-glass-tinted min-h-[44px]"
          aria-label="Get in touch - Navigate to contact section"
        >
          Get In Touch
        </a>
        
        <!-- Mobile menu button -->
        <button
          id="mobile-menu-button"
          class="md:hidden p-2 text-textSecondary hover:text-accent-blue transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center"
          aria-label="Toggle navigation menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Backdrop -->
  <div
    id="mobile-menu-backdrop"
    class="hidden md:hidden fixed inset-0 bg-black/20 backdrop-blur-sm z-40 transition-opacity duration-300"
    aria-hidden="true"
  ></div>

  <!-- Mobile Menu - Clean Apple Style -->
  <div
    id="mobile-menu"
    class="hidden md:hidden liquid-glass border-t border-black/5 relative z-50"
    role="menu"
    aria-labelledby="mobile-menu-button"
  >
    <div class="px-4 py-4 space-y-1">
      <a
        href="/#about"
        class="block text-textSecondary hover:text-accent-blue hover:bg-glass-tinted transition-all duration-300 font-medium py-3 px-4 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 min-h-[44px] flex items-center"
        role="menuitem"
        aria-label="Navigate to About section"
      >
        About
      </a>
      <a
        href="/#experience"
        class="block text-textSecondary hover:text-accent-blue hover:bg-glass-tinted transition-all duration-300 font-medium py-3 px-4 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 min-h-[44px] flex items-center"
        role="menuitem"
        aria-label="Navigate to Experience section"
      >
        Experience
      </a>
      <a
        href="/#projects"
        class="block text-textSecondary hover:text-accent-blue hover:bg-glass-tinted transition-all duration-300 font-medium py-3 px-4 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 min-h-[44px] flex items-center"
        role="menuitem"
        aria-label="Navigate to Projects section"
      >
        Projects
      </a>
      <a
        href="/#skills"
        class="block text-textSecondary hover:text-accent-blue hover:bg-glass-tinted transition-all duration-300 font-medium py-3 px-4 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 min-h-[44px] flex items-center"
        role="menuitem"
        aria-label="Navigate to Skills section"
      >
        Skills
      </a>
      <a
        href="/#contact"
        class="block text-textSecondary hover:text-accent-blue hover:bg-glass-tinted transition-all duration-300 font-medium py-3 px-4 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-accent-blue focus:ring-offset-2 min-h-[44px] flex items-center"
        role="menuitem"
        aria-label="Navigate to Contact section"
      >
        Contact
      </a>
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle with accessibility
  const menuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  const backdrop = document.getElementById('mobile-menu-backdrop');
  
  menuButton?.addEventListener('click', () => {
    const isHidden = mobileMenu?.classList.contains('hidden');
    if (mobileMenu) {
      mobileMenu.classList.toggle('hidden');
      menuButton?.setAttribute('aria-expanded', (!isHidden).toString());
      
      // Toggle backdrop
      if (backdrop) {
        backdrop.classList.toggle('hidden');
      }
    }
  });

  // Close mobile menu when clicking outside or on backdrop
  document.addEventListener('click', (e) => {
    const target = e.target as Node;
    if (!menuButton?.contains(target) && !mobileMenu?.contains(target)) {
      mobileMenu?.classList.add('hidden');
      if (backdrop) {
        backdrop.classList.add('hidden');
      }
      menuButton?.setAttribute('aria-expanded', 'false');
    }
  });
  
  // Close menu when clicking backdrop
  backdrop?.addEventListener('click', () => {
    mobileMenu?.classList.add('hidden');
    backdrop.classList.add('hidden');
    menuButton?.setAttribute('aria-expanded', 'false');
  });

  // Smooth scroll behavior for anchor links
  document.querySelectorAll('a[href^="/#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href')?.substring(1) || '');
      if (target) {
        target.scrollIntoView({ behavior: 'smooth' });
        mobileMenu?.classList.add('hidden');
        if (backdrop) {
          backdrop.classList.add('hidden');
        }
        menuButton?.setAttribute('aria-expanded', 'false');
      }
    });
  });

  // Add fluid scroll effect to nav (iOS 26 style)
  let lastScroll = 0;
  const nav = document.getElementById('main-nav');

  window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset;
    
    if (currentScroll <= 0) {
      nav?.classList.remove('shadow-glass');
      nav?.style.setProperty('backdrop-filter', 'blur(30px) saturate(180%)');
    } else if (currentScroll > 100) {
      nav?.classList.add('shadow-glass');
      // Subtle shrink on scroll for performance
      nav?.style.setProperty('backdrop-filter', 'blur(20px) saturate(180%)');
    }

    lastScroll = currentScroll;
  }, { passive: true });
</script>


