---
import "../styles/global.css";
import "../styles/liquid-glass.css";
import "../styles/accessibility.css";
import "../styles/mobile-ux.css";
import "../styles/interactions.css";
import Navigation from "../components/sections/Navigation.astro";
import Footer from "../components/layout/Footer.astro";
import ScrollProgress from "../components/ui/ScrollProgress";
import BackToTop from "../components/ui/BackToTop";
import CustomCursor from "../components/ui/CustomCursor";
import ActiveSectionIndicator from "../components/ui/ActiveSectionIndicator";
import AmbientLight from "../components/effects/AmbientLight";
import SkipToContent from "../components/ui/SkipToContent.astro";
import { getImage } from "astro:assets";
import FullFrame1 from "@/assets/images/FullFrame.png";

interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
}

const { 
  title = "Farhan Portfolio | Full-Stack Developer & DevOps Engineer",
  description = "Farhan's portfolio: Full-Stack Developer, DevOps, Cloud, and AI/ML. Explore projects, skills, and testimonials.",
  ogImage = "https://farhan.info/assets/images/profile.png"
} = Astro.props;

// Precompute the primary LCP candidate image (first project card)
const firstProjectLcpImage = await getImage({ src: FullFrame1, width: 350, height: 270, format: "webp" });
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <link rel="icon" type="image/svg+xml" href="/assets/logos/logo.svg" />
    <title>{title}</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet" />
    <link
      rel="preload"
      as="image"
      href={firstProjectLcpImage.src}
      imagesizes="(min-width: 640px) 351px, 296px"
      fetchpriority="high"
      type="image/webp"
    />
    <meta
      name="description"
      content={description}
    />
    <meta
      name="keywords"
      content="Farhan, portfolio, web developer, full-stack, DevOps, cloud, AI, ML, projects"
    />
    <meta name="author" content="Muhammad Farhan" />
    <!-- Open Graph / Facebook -->
    <meta
      property="og:title"
      content={title}
    />
    <meta
      property="og:description"
      content={description}
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={`https://farhan.info${Astro.url.pathname}`} />
    <meta
      property="og:image"
      content={ogImage}
    />
    <!-- Twitter -->
    <meta name="twitter:creator" content="@dullfarhan" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content={title}
    />
    <meta
      name="twitter:description"
      content={description}
    />
    <meta
      name="twitter:image"
      content={ogImage}
    />
    <script is:raw>
      // Load Clarity analytics with error handling
      try {
        (function (c, l, a, r, i, t, y) {
          if (typeof c === 'undefined' || typeof l === 'undefined') return;
          c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments); };
          t = l.createElement(r);
          t.async = 1;
          t.src = "https://www.clarity.ms/tag/" + i;
          t.onerror = function() { /* Silently fail if Clarity is unavailable */ };
          y = l.getElementsByTagName(r)[0];
          if (y && y.parentNode) {
            y.parentNode.insertBefore(t, y);
          }
        })(window, document, "clarity", "script", "shkxymcvd2");
      } catch (e) {
        // Silently ignore analytics errors
      }
    </script>
    <!-- Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Muhammad Farhan",
        "url": "https://farhan.info/",
        "sameAs": [
          "https://github.com/dullfarhan",
          "http://www.linkedin.com/in/dullfarhan"
        ],
        "image": "https://farhan.info/assets/images/profile.png",
        "jobTitle": "Full-Stack Developer, DevOps Engineer",
        "description": "Portfolio of Muhammad Farhan: Full-Stack Developer, DevOps, Cloud, and AI/ML.",
        "alumniOf": "FAST, National University of Computer and Emerging Sciences",
        "knowsAbout": [
          "JavaScript",
          "Python",
          "DevOps",
          "Cloud Computing",
          "Kubernetes",
          "CI/CD",
          "Astro",
          "AI/ML"
        ],
        "workLocation": {
          "@type": "Place",
          "address": {
            "@type": "PostalAddress",
            "addressLocality": "Lahore",
            "addressCountry": "PK"
          }
        }
      }
    </script>
  </head>
  <body class="relative bg-gradient-to-br from-amber-50 via-orange-50/80 to-rose-50/60 text-textPrimary">
    <!-- Skip to main content link for accessibility -->
    <SkipToContent />
    
    <!-- Warm gradient overlay for depth -->
    <div class="fixed inset-0 pointer-events-none z-0">
      <div class="absolute inset-0 bg-gradient-to-br from-amber-100/40 via-orange-50/30 to-rose-100/40"></div>
      <div class="absolute inset-0 bg-gradient-to-tl from-peach-100/30 via-transparent to-amber-50/40"></div>
      <div class="absolute inset-0 bg-gradient-radial from-orange-100/20 via-transparent to-transparent" style="background: radial-gradient(circle at 30% 20%, rgba(251, 191, 36, 0.15), transparent 60%), radial-gradient(circle at 70% 80%, rgba(251, 146, 60, 0.12), transparent 60%);"></div>
    </div>
    <!-- Subtle Apple-style Ambient Effects -->
    <AmbientLight client:only="react" />
    <ActiveSectionIndicator client:only="react" />
    
    <!-- Scroll Progress Bar -->
    <ScrollProgress client:only="react" />
    
    <!-- Premium Navigation -->
    <Navigation />
    
    <!-- Main Content (Relative to float above background effects) -->
    <div class="relative z-10 px-4 sm:px-8 md:px-12 lg:px-16 xl:px-20 pt-20">
      <div class="max-w-[1440px] mx-auto">
        <slot />
      </div>
    </div>
    
    <!-- Footer -->
    <Footer />
    
    <!-- Back to Top Button -->
    <BackToTop client:only="react" />
    
    <!-- Initialize smooth scroll and animations -->
    <script>
      import { initSmoothScroll } from '../utils/smooth-scroll';
      import { initScrollAnimations } from '../utils/animations';
      import { initParallaxEffects } from '../utils/parallax';
      import { initPerformanceOptimizations } from '../utils/performance';
      
      // Initialize performance optimizations immediately
      if (typeof window !== 'undefined') {
        initPerformanceOptimizations();
      }
      
      // Wait for everything to load
      window.addEventListener('load', () => {
        try {
          // Small delay to ensure React components are hydrated
          setTimeout(() => {
            initSmoothScroll();
            initScrollAnimations();
            initParallaxEffects();
          }, 100);
        } catch (error) {
          console.log('Animations initialized');
        }
      });
    </script>
  </body>
</html>

